#!/bin/bash

function start_kernel() {
  node ./System/Kernel/main.js &
  KERNEL_PID="$!"
}

function start_launcher() {
  node ./System/Launcher.app/main.js &
  LAUNCHER_PID="$!"
}

B=`realpath "$0"`
B=`dirname $B`
cd "$B/../../"

export KERNEL_PORT=3000
export KERNEL_WSPORT=3001
export DISPLAYSERVER_PORT=3002
export PATH="$PWD/System/bin:$PATH"

start_kernel

sleep 1
start_launcher

sleep 1
launch System/Display.app

sleep 2
dispatch DISPLAY init_windowmanager "simple"

sleep 1
launch Applications/Terminal.app

wait $KERNEL_PID
